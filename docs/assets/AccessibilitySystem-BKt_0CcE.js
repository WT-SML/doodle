import{P as y,r as $,E as g}from"./index-Q4h-y7xM.js";class _{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=_.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new y,this.page=new y,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,i,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,i,s,t,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var v=/iPhone/i,m=/iPod/i,O=/iPad/i,x=/\biOS-universal(?:.+)Mac\b/i,p=/\bAndroid(?:.+)Mobile\b/i,w=/Android/i,d=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,h=/Silk/i,l=/Windows Phone/i,T=/\bWindows(?:.+)ARM\b/i,A=/BlackBerry/i,D=/BB10/i,E=/Opera Mini/i,I=/\b(CriOS|Chrome)(?:.+)Mobile/i,M=/Mobile(?:.+)Firefox\b/i,P=function(o){return typeof o<"u"&&o.platform==="MacIntel"&&typeof o.maxTouchPoints=="number"&&o.maxTouchPoints>1&&typeof MSStream>"u"};function N(o){return function(e){return e.test(o)}}function k(o){var e={userAgent:"",platform:"",maxTouchPoints:0};!o&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof o=="string"?e.userAgent=o:o&&o.userAgent&&(e={userAgent:o.userAgent,platform:o.platform,maxTouchPoints:o.maxTouchPoints||0});var i=e.userAgent,s=i.split("[FBAN");typeof s[1]<"u"&&(i=s[0]),s=i.split("Twitter"),typeof s[1]<"u"&&(i=s[0]);var t=N(i),n={apple:{phone:t(v)&&!t(l),ipod:t(m),tablet:!t(v)&&(t(O)||P(e))&&!t(l),universal:t(x),device:(t(v)||t(m)||t(O)||t(x)||P(e))&&!t(l)},amazon:{phone:t(d),tablet:!t(d)&&t(h),device:t(d)||t(h)},android:{phone:!t(l)&&t(d)||!t(l)&&t(p),tablet:!t(l)&&!t(d)&&!t(p)&&(t(h)||t(w)),device:!t(l)&&(t(d)||t(h)||t(p)||t(w))||t(/\bokhttp\b/i)},windows:{phone:t(l),tablet:t(T),device:t(l)||t(T)},other:{blackberry:t(A),blackberry10:t(D),opera:t(E),firefox:t(M),chrome:t(I),device:t(A)||t(D)||t(E)||t(M)||t(I)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const B=k.default??k,L=B(globalThis.navigator),U=9,b=100,F=0,K=0,S=2,C=1,j=-1e3,R=-1e3,z=2,u=class H{constructor(e,i=L){this._mobileInfo=i,this.debug=!1,this._activateOnTab=!0,this._deactivateOnMouseMove=!0,this._isActive=!1,this._isMobileAccessibility=!1,this._div=null,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(i.tablet||i.phone)&&this._createTouchHook(),this._renderer=e}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){const e=document.createElement("button");e.style.width=`${C}px`,e.style.height=`${C}px`,e.style.position="absolute",e.style.top=`${j}px`,e.style.left=`${R}px`,e.style.zIndex=z.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){if(this._isActive)return;this._isActive=!0,this._div||(this._div=document.createElement("div"),this._div.style.width=`${b}px`,this._div.style.height=`${b}px`,this._div.style.position="absolute",this._div.style.top=`${F}px`,this._div.style.left=`${K}px`,this._div.style.zIndex=S.toString(),this._div.style.pointerEvents="none"),this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._deactivateOnMouseMove&&(this._onMouseMove=this._onMouseMove.bind(this),globalThis.document.addEventListener("mousemove",this._onMouseMove,!0));const e=this._renderer.view.canvas;if(e.parentNode)e.parentNode.appendChild(this._div),this._initAccessibilitySetup();else{const i=new MutationObserver(()=>{e.parentNode&&(e.parentNode.appendChild(this._div),i.disconnect(),this._initAccessibilitySetup())});i.observe(document.body,{childList:!0,subtree:!0})}}_initAccessibilitySetup(){this._renderer.runners.postrender.add(this),this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered)}_deactivate(){if(!(!this._isActive||this._isMobileAccessibility)){this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),this._activateOnTab&&globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this);for(const e of this._children)e._accessibleDiv&&e._accessibleDiv.parentNode&&(e._accessibleDiv.parentNode.removeChild(e._accessibleDiv),e._accessibleDiv=null),e._accessibleActive=!1;this._pool.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this._div&&this._div.parentNode&&this._div.parentNode.removeChild(this._div),this._pool=[],this._children=[]}}_updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&(e._accessibleActive||this._addChild(e),e._renderId=this._renderId);const i=e.children;if(i)for(let s=0;s<i.length;s++)this._updateAccessibleObjects(i[s])}init(e){const s={accessibilityOptions:{...H.defaultOptions.accessibilityOptions,...(e==null?void 0:e.accessibilityOptions)||{}}};this.debug=s.accessibilityOptions.debug,this._activateOnTab=s.accessibilityOptions.activateOnTab,this._deactivateOnMouseMove=s.accessibilityOptions.deactivateOnMouseMove,s.accessibilityOptions.enabledByDefault?this._activate():this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._renderer.runners.postrender.remove(this)}postrender(){const e=performance.now();if(this._mobileInfo.android.device&&e<this._androidUpdateCount||(this._androidUpdateCount=e+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas))return;const i=new Set;if(this._renderer.lastObjectRendered){this._updateAccessibleObjects(this._renderer.lastObjectRendered);for(const s of this._children)s._renderId===this._renderId&&i.add(this._children.indexOf(s))}for(let s=this._children.length-1;s>=0;s--){const t=this._children[s];i.has(s)||(t._accessibleDiv&&t._accessibleDiv.parentNode&&(t._accessibleDiv.parentNode.removeChild(t._accessibleDiv),this._pool.push(t._accessibleDiv),t._accessibleDiv=null),t._accessibleActive=!1,$(this._children,s,1))}if(this._renderer.renderingToScreen){const{x:s,y:t,width:n,height:a}=this._renderer.screen,r=this._div;r.style.left=`${s}px`,r.style.top=`${t}px`,r.style.width=`${n}px`,r.style.height=`${a}px`}for(let s=0;s<this._children.length;s++){const t=this._children[s];if(!t._accessibleActive||!t._accessibleDiv)continue;const n=t._accessibleDiv,a=t.hitArea||t.getBounds().rectangle;if(t.hitArea){const r=t.worldTransform,c=this._renderer.resolution,f=this._renderer.resolution;n.style.left=`${(r.tx+a.x*r.a)*c}px`,n.style.top=`${(r.ty+a.y*r.d)*f}px`,n.style.width=`${a.width*r.a*c}px`,n.style.height=`${a.height*r.d*f}px`}else{this._capHitArea(a);const r=this._renderer.resolution,c=this._renderer.resolution;n.style.left=`${a.x*r}px`,n.style.top=`${a.y*c}px`,n.style.width=`${a.width*r}px`,n.style.height=`${a.height*c}px`}}this._renderId++}_updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}_capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:i,height:s}=this._renderer;e.x+e.width>i&&(e.width=i-e.x),e.y+e.height>s&&(e.height=s-e.y)}_addChild(e){let i=this._pool.pop();i||(e.accessibleType==="button"?i=document.createElement("button"):(i=document.createElement(e.accessibleType),i.style.cssText=`
                        color: transparent;
                        pointer-events: none;
                        padding: 0;
                        margin: 0;
                        border: 0;
                        outline: 0;
                        background: transparent;
                        box-sizing: border-box;
                        user-select: none;
                        -webkit-user-select: none;
                        -moz-user-select: none;
                        -ms-user-select: none;
                    `,e.accessibleText&&(i.innerText=e.accessibleText)),i.style.width=`${b}px`,i.style.height=`${b}px`,i.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",i.style.position="absolute",i.style.zIndex=S.toString(),i.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?i.setAttribute("aria-live","off"):i.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?i.setAttribute("aria-relevant","additions"):i.setAttribute("aria-relevant","text"),i.addEventListener("click",this._onClick.bind(this)),i.addEventListener("focus",this._onFocus.bind(this)),i.addEventListener("focusout",this._onFocusOut.bind(this))),i.style.pointerEvents=e.accessiblePointerEvents,i.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?i.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(i.title=`container ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&i.setAttribute("aria-label",e.accessibleHint),this.debug&&this._updateDebugHTML(i),e._accessibleActive=!0,e._accessibleDiv=i,i.container=e,this._children.push(e),this._div.appendChild(e._accessibleDiv),e.interactive&&(e._accessibleDiv.tabIndex=e.tabIndex)}_dispatchEvent(e,i){const{container:s}=e.target,t=this._renderer.events.rootBoundary,n=Object.assign(new _(t),{target:s});t.rootTarget=this._renderer.lastObjectRendered,i.forEach(a=>t.dispatchEvent(n,a))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode!==U||!this._activateOnTab||this._activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this._deactivate()}destroy(){this._deactivate(),this._destroyTouchHook(),this._div=null,this._pool=null,this._children=null,this._renderer=null,this._activateOnTab&&globalThis.removeEventListener("keydown",this._onKeyDown)}setAccessibilityEnabled(e){e?this._activate():this._deactivate()}};u.extension={type:[g.WebGLSystem,g.WebGPUSystem],name:"accessibility"};u.defaultOptions={accessibilityOptions:{enabledByDefault:!1,debug:!1,activateOnTab:!0,deactivateOnMouseMove:!0}};let X=u;export{X as A,_ as F};
